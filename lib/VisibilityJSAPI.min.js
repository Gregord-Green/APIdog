// Visibility API
// https://github.com/ai/visibilityjs/tree/master/lib

(function(e){"use strict";var t=-1,n={onVisible:function(e){var t=n.isSupported();if(!t||!n.hidden()){e();return t}var r=n.change(function(t,i){if(!n.hidden()){n.unbind(r);e()}});return r},change:function(e){if(!n.isSupported())return false;t+=1;var r=t;n._callbacks[r]=e;n._listen();return r},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){var t=n.isSupported(),r="prerender";if(!t||r!=n.state()){e();return t}var i=n.change(function(t,s){if(r!=s){n.unbind(i);e()}});return i},hidden:function(){return!!(document.hidden||document.msHidden||document.mozHidden||document.webkitHidden)},state:function(){return document.visibilityState||document.msVisibilityState||document.mozVisibilityState||document.webkitVisibilityState||"visible"},isSupported:function(){return!!(document.visibilityState||document.msVisibilityState||document.mozVisibilityState||document.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(e){var t=n.state(),r;for(r in n._callbacks)n._callbacks[r].call(n._doc,e,t)},_listen:function(){if(n._init)return;var e="visibilitychange";if(document.webkitVisibilityState)e="webkit"+e;if(document.mozVisibilityState)e="moz"+e;if(document.msVisibilityState)e="ms"+e;var t=function(){n._change.apply(n,arguments)};if(document.addEventListener)document.addEventListener(e,t);else document.attachEvent(e,t);n._init=true}};if(typeof module!="undefined"&&module.exports)module.exports=n;else e.Visibility=n})(this);(function(e){"use strict";if(e.visibilityState||e.mozVisibilityState||e.webkitVisibilityState)return;e.hidden=false;e.visibilityState="visible";var t=null,n=0,r=function(){if(e.createEvent){if(!t){t=e.createEvent("HTMLEvents");t.initEvent("visibilitychange",true,true)}e.dispatchEvent(t)}else if(typeof Visibility=="object")Visibility._change.call(Visibility,{})},i=function(){e.hidden=false;e.visibilityState="visible";r()},s=function(){e.hidden=true;e.visibilityState="hidden";r()};if(e.addEventListener){window.addEventListener("focus",i,true);window.addEventListener("blur",s,true)}else{e.attachEvent("onfocusin",i);e.attachEvent("onfocusout",s)}})(document);(function(e){"use strict";var t=-1;var n=function(n){n.every=function(e,r,i){n._time();t+=1;var s=t;n._timers[s]={visible:r,hidden:i,callback:e};n._run(s,false);if(n.isSupported()){n._listen()}return s};n.stop=function(e){if(!n._timers[e]){return false}n._stop(e);delete n._timers[e];return true};n._timers={};n._time=function(){if(n._timed){return}n._timed=true;n._wasHidden=n.hidden();n.change(function(){n._stopRun();n._wasHidden=n.hidden()})};n._run=function(t,r){var i,s=n._timers[t];if(n.hidden()){if(null===s.hidden){return}i=s.hidden}else{i=s.visible}var o=function(){s.last=new Date;s.callback.call(e)};if(r){var u=new Date;var a=u-s.last;if(i>a){s.delay=setTimeout(function(){o();s.id=setInterval(o,i)},i-a)}else{o();s.id=setInterval(o,i)}}else{s.id=setInterval(o,i)}};n._stop=function(e){var t=n._timers[e];clearInterval(t.id);clearTimeout(t.delay);delete t.id;delete t.delay};n._stopRun=function(e){var t=n.hidden(),r=n._wasHidden;if(t&&!r||!t&&r){for(var i in n._timers){n._stop(i);n._run(i,!t)}}};return n};if(typeof module!="undefined"&&module.exports){module.exports=n(require("./visibility.core"))}else{n(e.Visibility)}})(window)